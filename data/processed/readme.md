# 📊 전처리된 데이터 설명서

## 📋 파일 정보

* **최종 업데이트**: 2025‑07‑30
* **생성 노트북**: `notebooks/01_social_vulnerability_korea.ipynb`
* **생성 스크립트**: `scripts/preprocess_population_data.py`
* **데이터 소스**: `data/raw/` 폴더(주민등록 · 외국인 · 장애인 인구, KIKcd 등)

## 🎯 전처리 목적

읍·면·동 단위 인구 데이터를 정제해 **사회취약지수**를 계산하고,
지수 결과를 **Folium Choropleth** 지도(`map.html`)로 바로 시각화할 수 있도록 표준 형태로 가공

## 📁 전처리된 데이터 파일 목록

| No. | 파일명                       | 용도                                 | 생성일        | 크기 (행/열)   |
| --- | ------------------------- | ---------------------------------- | ---------- | ---------- |
| 1   | `202506_읍면동_사회취약계층표.xlsx` | 사회취약계층 인구 집계(아동·고령·외국인·장애인)        | 2025‑06‑30 | 3 553 × 14 |
| 2   | `사회취약지수표.xlsx`            | 사회취약지수 계산 결과(vuln\_raw, vuln\_pct) | 2025‑07‑30 | 3 553 × 5  |
| 3   | `map.html`                | 전국 행정동 사회취약지수 Choropleth 지도        | 2025‑07‑30 | 2.8 MB     |

## 📁 원본 데이터

| 데이터                         | 출처        | 주요 컬럼       |
| --------------------------- | --------- | ----------- |
| 주민등록 인구 (15 세 미만 · 65 세 이상) | KOSIS     | 인구수         |
| 외국인 등록 인구                   | 법무부       | 외국인인구수      |
| 장애인 등록 인구 (시·군·구)           | 복지부       | 장애인인구수      |
| 법정동 코드 (2025‑07‑14)         | 행안부 KIKcd | 행정동코드, 읍면동명 |
| 전국 시도의 geojson 데이터        | Github | 각 읍면동 경계 좌표값 |

## 🔧 전처리 과정

### 1 단계: 코드 매핑 & 지역명 정규화

```python
# '제1동'→'1동', '1.2.3가동'→'1·2·3가동' 등 패턴 치환
# 말소·통합 코드는 최신 코드로 대체
```

### 2 단계: 데이터 병합

```python
total = (pop15
         .merge(pop65, on=['시도명','시군구명','읍면동명'])
         .merge(popFo, on=['시도명','시군구명','읍면동명'])
         .merge(popDP, on=['시도명','시군구명'], how='left'))
```

### 3 단계: 결측치 및 이상값 처리

* `총인구 == 0` 행 제거
* 인구 칼럼 `NaN → 0`, `Int64` 형태 유지

### 4 단계: 사회취약지수 계산 (가중합)

```python
weights = {'아동':0.20, '고령':0.35, '장애인':0.20, '외국인':0.25}
for k,w in weights.items():
    total[k+'_pct'] = total[k+'인구수'] / total['총인구'] * 100
    total[k+'_w']   = total[k+'_pct'] * w
total['vuln_raw'] = total[[k+'_w' for k in weights]].sum(axis=1)
total['vuln_pct'] = (total['vuln_raw']-total['vuln_raw'].min()) \
                   /(total['vuln_raw'].max()-total['vuln_raw'].min()) * 100
```

### 5 단계: 지도 생성

```python
# 시·도별 GeoJSON 병합 → geo_all
folium.Choropleth(
    geo_data = geo_all,
    data     = total,
    columns  = ('행정동코드','vuln_pct'),
    key_on   = 'feature.properties.adm_cd2',
    fill_color='YlOrRd', nan_fill_color='white',
    bins=[0,20,40,60,80,100]
).add_to(m)
m.save('map.html')
```

## 📊 최종 데이터 구조

### 202506\_읍면동\_사회취약계층표.xlsx

| 컬럼                 | 설명             | 단위 |
| ------------------ | -------------- | -- |
| 행정동코드              | 법정동 10→행정동 9자리 | -  |
| 시도명 / 시군구명 / 읍면동명  | 지역 명칭          | -  |
| 총인구                | 주민등록+외국인       | 명  |
| 아동·고령·외국인·장애인 인구수  | 각 집단 인구        | 명  |
| 아동\_pct … 외국인\_pct | 총인구 대비 비율      | %  |
| 사회취약지수            | 읍면동 별 사회취약지수 | %  | 

### 사회취약지수표.xlsx

| 컬럼        | 설명           |
| --------- | ------------ |
| 행정동코드     | -            |
| vuln\_raw | 가중합 원점수      |
| vuln\_pct | 0‑100 정규화 점수 |
| 취약등급      | 5분위 (1‒5)    |

### map.html

* **레이어**: 전국 행정동
* **색상**: `YlOrRd` 컬러셰일 (0 → 밝은 노랑, 100 → 진한 빨강)
* **팝업**: `읍면동명 · vuln_pct` 표시
* **범례**: 5 구간(0‑20, 20‑40, …) 자동 생성

## 🔍 데이터 품질 관리

* **지역명 매핑**: ‘전북특별자치도’ → ‘전라북도’ 등 통일
* **값 검증**: 인구 비율 0‑100 %, 총인구 > 0
* **지도 확인**: 누락 행정동 없는지 `map.html` 에서 수동 검수

## 📈 활용 방안

1. **취약지역 정책 지원**: `vuln_pct` 상위 10 % → 재난 안전·복지 자원 우선 배분
2. **연도별 비교**: 계산 로직 동일, 연도만 바꿔 추세 분석
3. **대시보드**: `map.html` 임베드 + Plotly 차트로 인터랙티브 대시보드 구현

## 🚨 주의사항

* **데이터 시점**: 모두 2025‑06 기준, 차기 업데이트 시 재전처리 필요
* **세종특별자치시**: 구군 없음 → 시 단일 행 유지
* **행정구역 개편**: 새로운 법정동 생성 시 KIKcd 최신판 적용

## 🔄 데이터 업데이트 이력

| 날짜         | 내용           | 파일                        |
| ---------- | ------------ | ------------------------- |
| 2025‑06‑30 | 인구집계 완료      | 202506\_읍면동\_사회취약계층표.xlsx |
| 2025‑07‑30 | 취약지수 계산 & 저장 | 사회취약지수표.xlsx              |
| 2025‑07‑30 | Folium 지도 생성 | map.html                  |

---

**마지막 검증** : 2025‑07‑30 | **전처리 버전** (지도 포함)
